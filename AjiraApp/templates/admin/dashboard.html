<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - DravTech Marketplace</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #7c3aed;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --border-color: #e2e8f0;
            --radius: 8px;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --card-bg: white;
            --sidebar-bg: #1e293b;
            --text-color: #1e293b;
            --text-light: #64748b;
        }

        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --secondary-color: #8b5cf6;
            --light-color: #0f172a;
            --dark-color: #f1f5f9;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --border-color: #334155;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            --card-bg: #1e293b;
            --sidebar-bg: #0f172a;
            --text-color: #f1f5f9;
            --text-light: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--sidebar-bg);
            color: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .logo {
            padding: 0 2rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 2rem;
            color: #cbd5e1;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left: 4px solid var(--primary-color);
        }

        .nav-badge {
            margin-left: auto;
            background: var(--danger-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            min-width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 2rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--text-color);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-color);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-color);
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .trend-up { color: var(--success-color); }
        .trend-down { color: var(--danger-color); }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        /* Tables */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
        }

        .card-header h2 {
            font-size: 1.3rem;
            color: var(--text-color);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
        }

        th {
            background: var(--light-color);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            color: var(--text-color);
        }

        tr:hover {
            background: var(--light-color);
        }

        /* Status Badges */
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
        }

        .badge-published { background: #d1fae5; color: #065f46; }
        .badge-draft { background: #fef3c7; color: #92400e; }
        .badge-pending { background: #fef3c7; color: #92400e; }
        .badge-contacted { background: #dbeafe; color: #1e40af; }
        .badge-completed { background: #d1fae5; color: #065f46; }
        .badge-processing { background: #e0e7ff; color: #3730a3; }
        .badge-cancelled { background: #fee2e2; color: #991b1b; }
        .badge-active { background: #d1fae5; color: #065f46; }
        .badge-inactive { background: #f3f4f6; color: #6b7280; }
        .badge-primary { background: #dbeafe; color: #1e40af; }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 14px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .btn-outline:hover {
            background: var(--light-color);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%231e293b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px;
        }

        [data-theme="dark"] select.form-control {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23f1f5f9'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--text-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Alert Messages */
        .alert {
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .alert-error {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .alert-warning {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }

        .alert-info {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }
            .main-content {
                margin-left: 200px;
            }
        }

        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 1rem 0;
            }
            
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .nav-menu {
                display: flex;
                overflow-x: auto;
                padding: 0 1rem;
            }
            
            .nav-item {
                margin-bottom: 0;
                flex-shrink: 0;
            }
            
            .nav-link {
                padding: 10px 15px;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .nav-link.active {
                border-left: none;
                border-bottom: 3px solid var(--primary-color);
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h2>
                    <i class="fas fa-chart-line"></i>
                    DravTech Admin
                </h2>
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="showSection('dashboard', this)">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('products', this)">
                        <i class="fas fa-box"></i>
                        Products
                        <span class="nav-badge" id="productsBadge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('categories', this)">
                        <i class="fas fa-tags"></i>
                        Categories
                        <span class="nav-badge" id="categoriesBadge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('apps', this)">
                        <i class="fas fa-mobile-alt"></i>
                        Apps
                        <span class="nav-badge" id="appsBadge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('orders', this)">
                        <i class="fas fa-shopping-cart"></i>
                        Orders
                        <span class="nav-badge" id="ordersBadge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('demos', this)">
                        <i class="fas fa-calendar-check"></i>
                        Demo Requests
                        <span class="nav-badge" id="demosBadge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('messages', this)">
                        <i class="fas fa-envelope"></i>
                        Messages
                        <span class="nav-badge" id="messagesBadge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="showSection('settings', this)">
                        <i class="fas fa-cog"></i>
                        Settings
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 id="pageTitle">Dashboard Overview</h1>
                <div class="header-actions">
                    <span>Welcome, Admin</span>
                    <button class="btn btn-primary" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-outline" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Alerts Container -->
            <div id="alertsContainer"></div>

            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card" onclick="showSection('products')">
                        <h3>Total Products</h3>
                        <div class="stat-number" id="statProducts">0</div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span id="statPublishedProducts">0 published</span>
                        </div>
                    </div>
                    
                    <div class="stat-card" onclick="showSection('categories')">
                        <h3>Active Categories</h3>
                        <div class="stat-number" id="statCategories">0</div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span id="statCategoryTypes">0 types</span>
                        </div>
                    </div>
                    
                    <div class="stat-card" onclick="showSection('apps')">
                        <h3>Total Apps</h3>
                        <div class="stat-number" id="statApps">0</div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>Latest added</span>
                        </div>
                    </div>
                    
                    <div class="stat-card" onclick="showSection('demos')">
                        <h3>Demo Requests</h3>
                        <div class="stat-number" id="statDemos">0</div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span id="statPendingDemos">0 pending</span>
                        </div>
                    </div>
                    
                    <div class="stat-card" onclick="showSection('orders')">
                        <h3>Total Orders</h3>
                        <div class="stat-number" id="statOrders">0</div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span id="statRevenue">$0 revenue</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="openProductModal()">
                        <i class="fas fa-plus"></i> Add New Product
                    </button>
                    <button class="btn btn-success" onclick="openCategoryModal()">
                        <i class="fas fa-tag"></i> Add New Category
                    </button>
                    <button class="btn btn-warning" onclick="openAppModal()">
                        <i class="fas fa-mobile-alt"></i> Add New App
                    </button>
                    <button class="btn btn-outline" onclick="exportData()">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h2>Recent Activity</h2>
                        <button class="btn btn-outline btn-sm" onclick="loadRecentActivity()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="table-container">
                        <table id="recentActivityTable">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Activity</th>
                                    <th>Details</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentActivityBody">
                                <!-- Loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Products Section -->
            <div id="productsSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Products Management</h2>
                        <div>
                            <button class="btn btn-outline" onclick="loadProducts()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-primary" onclick="openProductModal()">
                                <i class="fas fa-plus"></i> Add New Product
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Featured</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Products will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categoriesSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Categories Management</h2>
                        <button class="btn btn-primary" onclick="openCategoryModal()">
                            <i class="fas fa-plus"></i> Add New Category
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Products</th>
                                    <th>Status</th>
                                    <th>Order</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTableBody">
                                <!-- Categories will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Apps Section -->
            <div id="appsSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Apps Management</h2>
                        <div>
                            <button class="btn btn-outline" onclick="loadApps()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-primary" onclick="openAppModal()">
                                <i class="fas fa-plus"></i> Add New App
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>App</th>
                                    <th>URL</th>
                                    <th>Description</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="appsTableBody">
                                <!-- Apps will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Demo Requests Section -->
            <div id="demosSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Demo Requests Management</h2>
                        <div>
                            <select class="form-control" style="width: auto; display: inline-block;" 
                                    id="demoStatusFilter" onchange="loadDemos()">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="contacted">Contacted</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                            <button class="btn btn-outline ml-2" onclick="exportDemos()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Product</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="demosTableBody">
                                <!-- Demo requests will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="ordersSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Orders Management</h2>
                        <div>
                            <select class="form-control" style="width: auto; display: inline-block;" 
                                    id="orderStatusFilter" onchange="loadOrders()">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="processing">Processing</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Order #</th>
                                    <th>Customer</th>
                                    <th>Date</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Payment</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <!-- Orders will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Messages Section -->
            <div id="messagesSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>Messages Management</h2>
                        <button class="btn btn-outline" onclick="clearAllMessages()">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Message</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="messagesTableBody">
                                <!-- Messages will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>System Settings</h2>
                    </div>
                    <div style="padding: 1.5rem;">
                        <form id="settingsForm" onsubmit="updateSiteConfig(event)">
                            <div class="form-group">
                                <label class="form-label">Site Name</label>
                                <input type="text" class="form-control" id="siteName" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Admin Email</label>
                                <input type="email" class="form-control" id="siteEmail" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Default Currency</label>
                                <select class="form-control" id="currency" onchange="updateCurrencySymbol()">
                                    <option value="USD">USD ($)</option>
                                    <option value="EUR">EUR (€)</option>
                                    <option value="GBP">GBP (£)</option>
                                    <option value="KES">KES (KSh)</option>
                                    <option value="INR">INR (₹)</option>
                                    <option value="CNY">CNY (¥)</option>
                                    <option value="CUSTOM">Custom</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Currency Symbol</label>
                                <input type="text" class="form-control" id="currencySymbol" maxlength="5" required>
                            </div>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="siteActive" checked>
                                    <span>Active Configuration</span>
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle">Add New Product</h2>
                <button class="btn btn-outline" onclick="closeModal('productModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="productForm" onsubmit="saveProduct(event)">
                    <input type="hidden" id="productId">
                    
                    <div class="form-group">
                        <label class="form-label">Product Name *</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-control" id="productCategory" required>
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <textarea class="form-control" id="productDescription" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Short Description *</label>
                        <input type="text" class="form-control" id="productShortDesc" maxlength="300" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Price ($) *</label>
                        <input type="number" class="form-control" id="productPrice" step="0.01" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Discount Price ($)</label>
                        <input type="number" class="form-control" id="productDiscountPrice" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Product Image *</label>
                        <input type="file" class="form-control" id="productImage" accept="image/*">
                        <small>Leave empty to keep existing image</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Display Order</label>
                        <input type="number" class="form-control" id="productDisplayOrder" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Specifications (JSON format)</label>
                        <textarea class="form-control" id="productSpecifications" rows="3" 
                                  placeholder='{"resolution": "4K", "storage": "256GB"}'></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 1.5rem;">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="productFeatured">
                            <span>Featured Product</span>
                        </label>
                        
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <select id="productStatus">
                                <option value="draft">Draft</option>
                                <option value="published">Published</option>
                                <option value="archived">Archived</option>
                            </select>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-save"></i> Save Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="categoryModalTitle">Add New Category</h2>
                <button class="btn btn-outline" onclick="closeModal('categoryModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="categoryForm" onsubmit="saveCategory(event)">
                    <input type="hidden" id="categoryId">
                    
                    <div class="form-group">
                        <label class="form-label">Category Name *</label>
                        <input type="text" class="form-control" id="categoryName" 
                               placeholder="e.g., Web Development" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category Type *</label>
                        <input type="text" class="form-control" id="categoryType"
                               placeholder="e.g., Software, System, Design"
                               list="category-type-suggestions" required>
                        <datalist id="category-type-suggestions">
                            {% for type in existing_types %}
                            <option value="{{ type }}">
                            {% endfor %}
                        </datalist>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Display Order</label>
                        <input type="number" class="form-control" id="categoryDisplayOrder" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="categoryActive" checked>
                            <span>Active</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-save"></i> Save Category
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- App Modal -->
    <div class="modal" id="appModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="appModalTitle">Add New App</h2>
                <button class="btn btn-outline" onclick="closeModal('appModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="appForm" onsubmit="saveApp(event)">
                    <input type="hidden" id="appId">
                    
                    <div class="form-group">
                        <label class="form-label">App Name *</label>
                        <input type="text" class="form-control" id="appName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">App URL *</label>
                        <input type="url" class="form-control" id="appUrl" 
                               placeholder="https://example.com/app" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <textarea class="form-control" id="appDescription" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">App Image</label>
                        <input type="file" class="form-control" id="appImage" accept="image/*">
                        <small>Leave empty to keep existing image</small>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-save"></i> Save App
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Demo Details Modal -->
    <div class="modal" id="demoDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Demo Request Details</h2>
                <button class="btn btn-outline" onclick="closeModal('demoDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body" id="demoDetailsContent">
                <!-- Details loaded via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div class="modal" id="orderDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Order Details</h2>
                <button class="btn btn-outline" onclick="closeModal('orderDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body" id="orderDetailsContent">
                <!-- Details loaded via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Message Details Modal -->
    <div class="modal" id="messageDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Message Details</h2>
                <button class="btn btn-outline" onclick="closeModal('messageDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body" id="messageDetailsContent">
                <!-- Details loaded via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="confirmTitle">Confirm Action</h2>
                <button class="btn btn-outline" onclick="closeModal('confirmModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <p id="confirmMessage">Are you sure you want to perform this action?</p>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-outline" onclick="closeModal('confirmModal')">Cancel</button>
                    <button class="btn btn-danger" id="confirmActionBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script>
        // CSRF Token
        function getCsrfToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Toast notifications
        function showToast(message, type = 'info') {
            const backgroundColor = type === 'success' ? '#10b981' : 
                                  type === 'error' ? '#ef4444' : 
                                  type === 'warning' ? '#f59e0b' : '#3b82f6';
            
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                style: {
                    background: backgroundColor,
                },
                stopOnFocus: true,
            }).showToast();
        }

        // Theme Management
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });
        
        function updateThemeIcon(theme) {
            themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Navigation
        function showSection(sectionId, clickedElement = null) {
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            
            document.getElementById(sectionId + 'Section').style.display = 'block';
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            if (clickedElement) {
                clickedElement.classList.add('active');
            } else {
                // Find and activate the corresponding nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link.textContent.includes(getSectionTitle(sectionId))) {
                        link.classList.add('active');
                    }
                });
            }
            
            const titles = {
                'dashboard': 'Dashboard Overview',
                'products': 'Products Management',
                'categories': 'Categories Management',
                'apps': 'Apps Management',
                'orders': 'Orders Management',
                'demos': 'Demo Requests Management',
                'messages': 'Messages Management',
                'settings': 'System Settings'
            };
            
            document.getElementById('pageTitle').textContent = titles[sectionId] || 'Dashboard Overview';
            
            // Load section data
            switch(sectionId) {
                case 'dashboard':
                    loadDashboardStats();
                    loadRecentActivity();
                    break;
                case 'products':
                    loadProducts();
                    loadCategoriesForSelect();
                    break;
                case 'categories':
                    loadCategories();
                    break;
                case 'apps':
                    loadApps();
                    break;
                case 'demos':
                    loadDemos();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'messages':
                    loadMessages();
                    break;
                case 'settings':
                    loadSiteConfig();
                    break;
            }
            
            window.scrollTo(0, 0);
        }

        function getSectionTitle(sectionId) {
            const titles = {
                'dashboard': 'Dashboard',
                'products': 'Products',
                'categories': 'Categories',
                'apps': 'Apps',
                'orders': 'Orders',
                'demos': 'Demo Requests',
                'messages': 'Messages',
                'settings': 'Settings'
            };
            return titles[sectionId] || '';
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Dashboard Functions
        async function loadDashboardStats() {
            try {
                const response = await fetch('/dravtech/admin/api/stats/');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    
                    document.getElementById('statProducts').textContent = stats.total_products || 0;
                    document.getElementById('statPublishedProducts').textContent = `${stats.published_products || 0} published`;
                    document.getElementById('statCategories').textContent = stats.categories_count || 0;
                    document.getElementById('statCategoryTypes').textContent = stats.category_types || '0 types';
                    document.getElementById('statApps').textContent = stats.total_apps || 0;
                    document.getElementById('statDemos').textContent = stats.demo_requests_count || 0;
                    document.getElementById('statPendingDemos').textContent = `${stats.pending_demos || 0} pending`;
                    document.getElementById('statOrders').textContent = stats.total_orders || 0;
                    document.getElementById('statRevenue').textContent = `$${stats.revenue_total || 0} revenue`;
                    
                    // Update badges
                    document.getElementById('productsBadge').textContent = stats.total_products || 0;
                    document.getElementById('categoriesBadge').textContent = stats.categories_count || 0;
                    document.getElementById('appsBadge').textContent = stats.total_apps || 0;
                    document.getElementById('demosBadge').textContent = stats.demo_requests_count || 0;
                    document.getElementById('ordersBadge').textContent = stats.total_orders || 0;
                    document.getElementById('messagesBadge').textContent = stats.unread_messages || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                // Set default values
                document.getElementById('statProducts').textContent = '0';
                document.getElementById('statCategories').textContent = '0';
                document.getElementById('statApps').textContent = '0';
                document.getElementById('statDemos').textContent = '0';
                document.getElementById('statOrders').textContent = '0';
            }
        }

        async function loadRecentActivity() {
            try {
                const response = await fetch('/dravtech/admin/api/refresh/');
                const data = await response.json();
                
                if (data.success) {
                    const tbody = document.getElementById('recentActivityBody');
                    tbody.innerHTML = '';
                    
                    if (data.data && data.data.products) {
                        data.data.products.forEach(product => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>Just now</td>
                                <td>Product: ${product.name}</td>
                                <td>${product.category}</td>
                                <td><span class="badge badge-${product.status === 'published' ? 'published' : 'draft'}">${product.status}</span></td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                    
                    if (data.data && data.data.apps) {
                        data.data.apps.forEach(app => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>Just now</td>
                                <td>App: ${app.name}</td>
                                <td>${app.url.substring(0, 30)}...</td>
                                <td><span class="badge badge-primary">Added</span></td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                    
                    if (data.data && data.data.demos) {
                        data.data.demos.forEach(demo => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>Today</td>
                                <td>Demo Request: ${demo.name}</td>
                                <td>${demo.product}</td>
                                <td><span class="badge badge-${demo.status}">${demo.status}</span></td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                    
                    if (data.data && data.data.orders) {
                        data.data.orders.forEach(order => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>Today</td>
                                <td>Order: ${order.order_number}</td>
                                <td>${order.customer} - $${order.total}</td>
                                <td><span class="badge badge-${order.status}">${order.status}</span></td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                    
                    if (data.data && data.data.messages) {
                        data.data.messages.forEach(msg => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${msg.created_at}</td>
                                <td>${msg.type === 'contact' ? 'Contact' : 'Portfolio'} Message</td>
                                <td>${msg.name}: ${msg.preview}</td>
                                <td><span class="badge ${msg.is_read ? 'badge-completed' : 'badge-pending'}">${msg.is_read ? 'Read' : 'Unread'}</span></td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                    
                    if (tbody.innerHTML === '') {
                        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem;">No recent activity</td></tr>';
                    }
                }
            } catch (error) {
                console.error('Error loading activity:', error);
                const tbody = document.getElementById('recentActivityBody');
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem;">Error loading recent activity</td></tr>';
            }
        }

        // Product Management
        async function loadProducts() {
            try {
                const tbody = document.getElementById('productsTableBody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;"><div class="spinner"></div></td></tr>';
                
                const response = await fetch('/dravtech/admin/api/products/');
                const data = await response.json();
                
                if (data.success) {
                    tbody.innerHTML = '';
                    
                    if (data.products.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No products found.</td></tr>';
                        return;
                    }
                    
                    data.products.forEach(product => {
                        const row = document.createElement('tr');
                        row.id = `product-${product.id}`;
                        row.innerHTML = `
                            <td>${product.id}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    ${product.image_url ? `<img src="${product.image_url}" alt="${product.name}" style="width: 40px; height: 40px; border-radius: 4px; object-fit: cover;">` : ''}
                                    <div>
                                        <strong>${product.name}</strong><br>
                                        <small style="color: var(--text-light);">${product.created_at}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge">${product.category}</span>
                            </td>
                            <td>
                                ${product.discount_price ? `
                                    <span style="text-decoration: line-through; color: var(--text-light);">$${product.price}</span><br>
                                    <span style="color: var(--danger-color); font-weight: bold;">$${product.discount_price}</span>
                                ` : `$${product.price}`}
                            </td>
                            <td>
                                <span class="badge badge-${product.status}">${product.status}</span>
                            </td>
                            <td>
                                ${product.is_featured ? '<i class="fas fa-star" style="color: var(--warning-color);"></i>' : '<i class="far fa-star" style="color: var(--text-light);"></i>'}
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline" onclick="editProduct(${product.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Error loading products</td></tr>';
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showToast('Error loading products', 'error');
                const tbody = document.getElementById('productsTableBody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Error loading products</td></tr>';
            }
        }

        async function loadCategoriesForSelect() {
            try {
                const response = await fetch('/dravtech/admin/api/categories/');
                const data = await response.json();
                
                if (data.success) {
                    const select = document.getElementById('productCategory');
                    select.innerHTML = '<option value="">Select Category</option>';
                    
                    data.categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = `${category.name} (${category.category_type})`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading categories for select:', error);
            }
        }

        async function openProductModal(productId = null) {
            const modal = document.getElementById('productModal');
            const title = document.getElementById('productModalTitle');
            const form = document.getElementById('productForm');
            
            if (productId) {
                title.textContent = 'Edit Product';
                
                try {
                    const response = await fetch(`/dravtech/admin/api/products/${productId}/`);
                    const data = await response.json();
                    
                    if (data.success) {
                        document.getElementById('productId').value = data.product.id;
                        document.getElementById('productName').value = data.product.name;
                        document.getElementById('productCategory').value = data.product.category_id;
                        document.getElementById('productDescription').value = data.product.description;
                        document.getElementById('productShortDesc').value = data.product.short_description;
                        document.getElementById('productPrice').value = data.product.price;
                        document.getElementById('productDiscountPrice').value = data.product.discount_price || '';
                        document.getElementById('productDisplayOrder').value = data.product.display_order;
                        document.getElementById('productSpecifications').value = data.product.specifications ? JSON.stringify(data.product.specifications) : '';
                        document.getElementById('productFeatured').checked = data.product.is_featured;
                        document.getElementById('productStatus').value = data.product.status;
                    }
                } catch (error) {
                    console.error('Error loading product:', error);
                    showToast('Error loading product data', 'error');
                }
            } else {
                title.textContent = 'Add New Product';
                form.reset();
                document.getElementById('productId').value = '';
                document.getElementById('productStatus').value = 'draft';
            }
            
            openModal('productModal');
        }

        async function editProduct(productId) {
            await openProductModal(productId);
        }

        async function saveProduct(event) {
            event.preventDefault();
            
            const productId = document.getElementById('productId').value;
            const formData = new FormData();
            
            // Append all form data
            formData.append('name', document.getElementById('productName').value);
            formData.append('category', document.getElementById('productCategory').value);
            formData.append('description', document.getElementById('productDescription').value);
            formData.append('short_description', document.getElementById('productShortDesc').value);
            formData.append('price', document.getElementById('productPrice').value);
            
            const discountPrice = document.getElementById('productDiscountPrice').value;
            if (discountPrice) {
                formData.append('discount_price', discountPrice);
            }
            
            formData.append('display_order', document.getElementById('productDisplayOrder').value);
            
            const specs = document.getElementById('productSpecifications').value;
            if (specs) {
                try {
                    // Validate JSON
                    JSON.parse(specs);
                    formData.append('specifications', specs);
                } catch (e) {
                    showToast('Invalid JSON format for specifications', 'error');
                    return;
                }
            }
            
            formData.append('is_featured', document.getElementById('productFeatured').checked);
            formData.append('status', document.getElementById('productStatus').value);
            
            // Handle image file
            const imageFile = document.getElementById('productImage').files[0];
            if (imageFile) {
                // Check file size (max 5MB)
                if (imageFile.size > 5 * 1024 * 1024) {
                    showToast('Image size should be less than 5MB', 'error');
                    return;
                }
                // Check file type
                if (!imageFile.type.startsWith('image/')) {
                    showToast('Please select an image file', 'error');
                    return;
                }
                formData.append('image', imageFile);
            } else if (!productId) {
                // New product requires an image
                showToast('Please select an image for the product', 'error');
                return;
            }
            
            try {
                const url = productId ? 
                    `/dravtech/admin/api/products/${productId}/edit/` : 
                    '/dravtech/admin/api/products/create/';
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    closeModal('productModal');
                    loadProducts();
                    loadDashboardStats();
                } else {
                    // Display form errors
                    if (data.errors) {
                        let errorMessages = [];
                        for (const field in data.errors) {
                            errorMessages.push(`${field}: ${data.errors[field].join(', ')}`);
                        }
                        showToast(errorMessages.join('\n'), 'error');
                    } else {
                        showToast(data.error_message || data.error || 'Error saving product', 'error');
                    }
                }
            } catch (error) {
                console.error('Error saving product:', error);
                showToast('Error saving product: ' + error.message, 'error');
            }
        }

        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            try {
                const response = await fetch(`/dravtech/admin/api/products/${productId}/delete/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    document.getElementById(`product-${productId}`).remove();
                    loadDashboardStats();
                } else {
                    showToast(data.error, 'error');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                showToast('Error deleting product', 'error');
            }
        }

        // Category Management
        async function loadCategories() {
            try {
                const tbody = document.getElementById('categoriesTableBody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;"><div class="spinner"></div></td></tr>';
                
                const response = await fetch('/dravtech/admin/api/categories/');
                const data = await response.json();
                
                if (data.success) {
                    tbody.innerHTML = '';
                    
                    if (data.categories.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No categories found.</td></tr>';
                        return;
                    }
                    
                    data.categories.forEach(category => {
                        const row = document.createElement('tr');
                        row.id = `category-${category.id}`;
                        row.innerHTML = `
                            <td>${category.id}</td>
                            <td><strong>${category.name}</strong></td>
                            <td><span class="badge">${category.category_type}</span></td>
                            <td>${category.product_count} products</td>
                            <td>
                                <span class="badge ${category.is_active ? 'badge-active' : 'badge-inactive'}">
                                    ${category.is_active ? 'Active' : 'Inactive'}
                                </span>
                            </td>
                            <td>${category.display_order}</td>
                            <td>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline" onclick="editCategory(${category.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCategory(${category.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Error loading categories</td></tr>';
                }
            } catch (error) {
                console.error('Error loading categories:', error);
                showToast('Error loading categories', 'error');
                const tbody = document.getElementById('categoriesTableBody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Error loading categories</td></tr>';
            }
        }

        async function openCategoryModal(categoryId = null) {
            const modal = document.getElementById('categoryModal');
            const title = document.getElementById('categoryModalTitle');
            
            if (categoryId) {
                title.textContent = 'Edit Category';
                
                try {
                    const response = await fetch(`/dravtech/admin/api/categories/${categoryId}/`);
                    const data = await response.json();
                    
                    if (data.success) {
                        document.getElementById('categoryId').value = data.category.id;
                        document.getElementById('categoryName').value = data.category.name;
                        document.getElementById('categoryType').value = data.category.category_type;
                        document.getElementById('categoryDisplayOrder').value = data.category.display_order;
                        document.getElementById('categoryActive').checked = data.category.is_active;
                    }
                } catch (error) {
                    console.error('Error loading category:', error);
                    showToast('Error loading category data', 'error');
                }
            } else {
                title.textContent = 'Add New Category';
                document.getElementById('categoryForm').reset();
                document.getElementById('categoryId').value = '';
                document.getElementById('categoryActive').checked = true;
            }
            
            openModal('categoryModal');
        }

        async function editCategory(categoryId) {
            await openCategoryModal(categoryId);
        }

        async function saveCategory(event) {
            event.preventDefault();
            
            const categoryId = document.getElementById('categoryId').value;
            const categoryData = {
                name: document.getElementById('categoryName').value,
                category_type: document.getElementById('categoryType').value,
                display_order: document.getElementById('categoryDisplayOrder').value,
                is_active: document.getElementById('categoryActive').checked
            };
            
            try {
                const url = categoryId ? 
                    `/dravtech/admin/api/categories/${categoryId}/edit/` : 
                    '/dravtech/admin/api/categories/create/';
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(categoryData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    closeModal('categoryModal');
                    loadCategories();
                    loadCategoriesForSelect();
                    loadDashboardStats();
                } else {
                    showToast(data.error || 'Error saving category', 'error');
                }
            } catch (error) {
                console.error('Error saving category:', error);
                showToast('Error saving category', 'error');
            }
        }

        async function deleteCategory(categoryId) {
            if (!confirm('Are you sure you want to delete this category?')) return;
            
            try {
                const response = await fetch(`/dravtech/admin/api/categories/${categoryId}/delete/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    document.getElementById(`category-${categoryId}`).remove();
                    loadDashboardStats();
                } else {
                    showToast(data.error, 'error');
                }
            } catch (error) {
                console.error('Error deleting category:', error);
                showToast('Error deleting category', 'error');
            }
        }

        // Apps Management
        async function loadApps() {
            try {
                const tbody = document.getElementById('appsTableBody');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;"><div class="spinner"></div></td></tr>';
                
                const response = await fetch('/api/apps/');
                const data = await response.json();
                
                if (data.success) {
                    tbody.innerHTML = '';
                    
                    if (data.apps.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No apps found.</td></tr>';
                        return;
                    }
                    
                    data.apps.forEach(app => {
                        const row = document.createElement('tr');
                        row.id = `app-${app.id}`;
                        row.innerHTML = `
                            <td>${app.id}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    ${app.image ? `<img src="${app.image}" alt="${app.name}" style="width: 40px; height: 40px; border-radius: 4px; object-fit: cover;">` : ''}
                                    <div>
                                        <strong>${app.name}</strong>
                                    </div>
                                </div>
                            </td>
                            <td><a href="${app.url}" target="_blank">${app.url.substring(0, 30)}...</a></td>
                            <td>${app.description.substring(0, 50)}...</td>
                            <td>${app.created_at}</td>
                            <td>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline" onclick="editApp(${app.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteApp(${app.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">Error loading apps</td></tr>';
                }
            } catch (error) {
                console.error('Error loading apps:', error);
                showToast('Error loading apps', 'error');
                const tbody = document.getElementById('appsTableBody');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">Error loading apps</td></tr>';
            }
        }

        async function openAppModal(appId = null) {
            const modal = document.getElementById('appModal');
            const title = document.getElementById('appModalTitle');
            const form = document.getElementById('appForm');
            
            if (appId) {
                title.textContent = 'Edit App';
                
                try {
                    const response = await fetch(`/api/apps/${appId}/`);
                    const data = await response.json();
                    
                    if (data.success) {
                        document.getElementById('appId').value = data.app.id;
                        document.getElementById('appName').value = data.app.name;
                        document.getElementById('appUrl').value = data.app.url;
                        document.getElementById('appDescription').value = data.app.description;
                    }
                } catch (error) {
                    console.error('Error loading app:', error);
                    showToast('Error loading app data', 'error');
                }
            } else {
                title.textContent = 'Add New App';
                form.reset();
                document.getElementById('appId').value = '';
            }
            
            openModal('appModal');
        }

        async function editApp(appId) {
            await openAppModal(appId);
        }

        async function saveApp(event) {
            event.preventDefault();
            
            const appId = document.getElementById('appId').value;
            const formData = new FormData();
            
            // Append all form data
            formData.append('name', document.getElementById('appName').value);
            formData.append('url', document.getElementById('appUrl').value);
            formData.append('description', document.getElementById('appDescription').value);
            
            // Handle image file
            const imageFile = document.getElementById('appImage').files[0];
            if (imageFile) {
                // Check file size (max 5MB)
                if (imageFile.size > 5 * 1024 * 1024) {
                    showToast('Image size should be less than 5MB', 'error');
                    return;
                }
                // Check file type
                if (!imageFile.type.startsWith('image/')) {
                    showToast('Please select an image file', 'error');
                    return;
                }
                formData.append('image', imageFile);
            } else if (!appId) {
                // New app doesn't require an image
                // formData.append('image', ''); // Optional
            }
            
            try {
                const url = appId ? 
                    `/api/apps/${appId}/` : 
                    '/api/apps/';
                
                const method = appId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message || 'App saved successfully', 'success');
                    closeModal('appModal');
                    loadApps();
                    loadDashboardStats();
                } else {
                    showToast(data.error || 'Error saving app', 'error');
                }
            } catch (error) {
                console.error('Error saving app:', error);
                showToast('Error saving app: ' + error.message, 'error');
            }
        }

        async function deleteApp(appId) {
            if (!confirm('Are you sure you want to delete this app?')) return;
            
            try {
                const response = await fetch(`/api/apps/${appId}/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    document.getElementById(`app-${appId}`).remove();
                    loadDashboardStats();
                } else {
                    showToast(data.error, 'error');
                }
            } catch (error) {
                console.error('Error deleting app:', error);
                showToast('Error deleting app', 'error');
            }
        }

        // Site Configuration
        async function loadSiteConfig() {
            try {
                const response = await fetch('/dravtech/admin/api/config/');
                const data = await response.json();
                
                if (data.success) {
                    const config = data.config;
                    document.getElementById('siteName').value = config.site_name || 'DravTech Marketplace';
                    document.getElementById('siteEmail').value = config.site_email || 'admin@dravtech.com';
                    document.getElementById('currency').value = config.currency || 'USD';
                    document.getElementById('currencySymbol').value = config.currency_symbol || '$';
                    document.getElementById('siteActive').checked = config.is_active || true;
                }
            } catch (error) {
                console.error('Error loading site config:', error);
                // Set defaults
                document.getElementById('siteName').value = 'DravTech Marketplace';
                document.getElementById('siteEmail').value = 'admin@dravtech.com';
                document.getElementById('currency').value = 'USD';
                document.getElementById('currencySymbol').value = '$';
                document.getElementById('siteActive').checked = true;
            }
        }

        function updateCurrencySymbol() {
            const currency = document.getElementById('currency').value;
            const symbols = {
                'USD': '$',
                'EUR': '€',
                'GBP': '£',
                'KES': 'KSh',
                'INR': '₹',
                'CNY': '¥',
            };
            
            if (currency !== 'CUSTOM' && symbols[currency]) {
                document.getElementById('currencySymbol').value = symbols[currency];
            } else if (currency === 'CUSTOM') {
                document.getElementById('currencySymbol').value = '';
                document.getElementById('currencySymbol').focus();
            }
        }

        async function updateSiteConfig(event) {
            event.preventDefault();
            
            const configData = {
                site_name: document.getElementById('siteName').value,
                site_email: document.getElementById('siteEmail').value,
                currency: document.getElementById('currency').value,
                currency_symbol: document.getElementById('currencySymbol').value,
                is_active: document.getElementById('siteActive').checked
            };
            
            try {
                const response = await fetch('/dravtech/admin/api/config/update/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(configData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                } else {
                    showToast(data.error || 'Error updating settings', 'error');
                }
            } catch (error) {
                console.error('Error updating site config:', error);
                showToast('Error updating settings', 'error');
            }
        }

        // Demo Requests Management
        async function loadDemos() {
            try {
                const statusFilter = document.getElementById('demoStatusFilter').value;
                const tbody = document.getElementById('demosTableBody');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;"><div class="spinner"></div></td></tr>';
                
                const url = statusFilter ? 
                    `/dravtech/admin/api/demos/?status=${statusFilter}` : 
                    '/dravtech/admin/api/demos/';
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    tbody.innerHTML = '';
                    
                    if (data.demos.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No demo requests found.</td></tr>';
                        return;
                    }
                    
                    data.demos.forEach(demo => {
                        const row = document.createElement('tr');
                        row.id = `demo-${demo.id}`;
                        row.innerHTML = `
                            <td>${demo.requested_at}</td>
                            <td>${demo.full_name}</td>
                            <td>${demo.email}</td>
                            <td>${demo.product}</td>
                            <td>
                                <select class="form-control" style="padding: 4px 8px; font-size: 0.9rem;" 
                                        onchange="updateDemoStatus(${demo.id}, this.value)">
                                    <option value="pending" ${demo.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="contacted" ${demo.status === 'contacted' ? 'selected' : ''}>Contacted</option>
                                    <option value="completed" ${demo.status === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="cancelled" ${demo.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                </select>
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline" onclick="viewDemoDetails(${demo.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteDemo(${demo.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">Error loading demo requests</td></tr>';
                }
            } catch (error) {
                console.error('Error loading demos:', error);
                showToast('Error loading demo requests', 'error');
                const tbody = document.getElementById('demosTableBody');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">Error loading demo requests</td></tr>';
            }
        }

        async function updateDemoStatus(demoId, status) {
            try {
                const response = await fetch(`/dravtech/admin/api/demos/${demoId}/status/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: status })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    loadDashboardStats();
                } else {
                    showToast(data.error, 'error');
                }
            } catch (error) {
                console.error('Error updating demo status:', error);
                showToast('Error updating status', 'error');
            }
        }

        async function viewDemoDetails(demoId) {
            try {
                const response = await fetch(`/dravtech/admin/api/demos/${demoId}/`);
                const data = await response.json();
                
                if (data.success) {
                    const demo = data.demo;
                    const content = `
                        <div style="line-height: 1.6;">
                            <h3 style="margin-bottom: 20px;">Demo Request Details</h3>
                            <p><strong>Name:</strong> ${demo.full_name}</p>
                            <p><strong>Email:</strong> ${demo.email}</p>
                            <p><strong>Phone:</strong> ${demo.phone || 'Not provided'}</p>
                            <p><strong>Company:</strong> ${demo.company || 'Not provided'}</p>
                            <p><strong>Product:</strong> ${demo.product || 'General Inquiry'}</p>
                            <p><strong>Interest Area:</strong> ${demo.interest_area || 'Not specified'}</p>
                            <p><strong>Status:</strong> <span class="badge badge-${demo.status}">${demo.status}</span></p>
                            <p><strong>Requested At:</strong> ${demo.requested_at}</p>
                            ${demo.contacted_at ? `<p><strong>Contacted At:</strong> ${demo.contacted_at}</p>` : ''}
                            <p><strong>Message:</strong></p>
                            <div style="background: var(--light-color); padding: 15px; border-radius: var(--radius); margin-top: 10px;">
                                ${demo.message || 'No message provided.'}
                            </div>
                            ${demo.notes ? `<p><strong>Admin Notes:</strong><br>${demo.notes}</p>` : ''}
                        </div>
                    `;
                    document.getElementById('demoDetailsContent').innerHTML = content;
                    openModal('demoDetailsModal');
                }
            } catch (error) {
                console.error('Error loading demo details:', error);
                showToast('Error loading demo details', 'error');
            }
        }

        async function deleteDemo(demoId) {
            if (!confirm('Are you sure you want to delete this demo request?')) return;
            
            try {
                const response = await fetch(`/dravtech/admin/api/demos/${demoId}/delete/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    document.getElementById(`demo-${demoId}`).remove();
                    loadDashboardStats();
                } else {
                    showToast(data.error, 'error');
                }
            } catch (error) {
                console.error('Error deleting demo:', error);
                showToast('Error deleting demo request', 'error');
            }
        }

        // Orders Management
        async function loadOrders() {
            try {
                const statusFilter = document.getElementById('orderStatusFilter').value;
                const tbody = document.getElementById('ordersTableBody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;"><div class="spinner"></div></td></tr>';
                
                const url = statusFilter ? 
                    `/dravtech/admin/api/orders/?status=${statusFilter}` : 
                    '/dravtech/admin/api/orders/';
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    tbody.innerHTML = '';
                    
                    if (data.orders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No orders found.</td></tr>';
                        return;
                    }
                    
                    data.orders.forEach(order => {
                        const row = document.createElement('tr');
                        row.id = `order-${order.id}`;
                        row.innerHTML = `
                            <td>${order.order_number}</td>
                            <td>
                                <strong>${order.customer_name}</strong><br>
                                <small>${order.customer_email}</small>
                            </td>
                            <td>${order.created_at}</td>
                            <td>$${order.total}</td>
                            <td>
                                <select class="form-control" style="padding: 4px 8px; font-size: 0.9rem;" 
                                        onchange="updateOrderStatus(${order.id}, this.value)">
                                    <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                                    <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                </select>
                            </td>
                            <td>
                                <span class="badge ${order.payment_status ? 'badge-completed' : 'badge-pending'}">
                                    ${order.payment_status ? 'Paid' : 'Pending'}
                                </span>
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline" onclick="viewOrderDetails(${order.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Error loading orders</td></tr>';
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                showToast('Error loading orders', 'error');
                const tbody = document.getElementById('ordersTableBody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Error loading orders</td></tr>';
            }
        }

        async function updateOrderStatus(orderId, status) {
            try {
                const response = await fetch(`/dravtech/admin/api/orders/${orderId}/status/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: status })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                } else {
                    showToast(data.error, 'error');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                showToast('Error updating order status', 'error');
            }
        }

        async function viewOrderDetails(orderId) {
            try {
                const response = await fetch(`/dravtech/admin/api/orders/${orderId}/`);
                const data = await response.json();
                
                if (data.success) {
                    const order = data.order;
                    let itemsHtml = '';
                    
                    if (order.items) {
                        order.items.forEach(item => {
                            itemsHtml += `
                                <tr>
                                    <td>${item.product_name}</td>
                                    <td>${item.quantity}</td>
                                    <td>$${item.price}</td>
                                    <td>$${item.total}</td>
                                </tr>
                            `;
                        });
                    }
                    
                    const content = `
                        <div style="line-height: 1.6;">
                            <h3 style="margin-bottom: 20px;">Order Details: ${order.order_number}</h3>
                            
                            <h4>Customer Information</h4>
                            <p><strong>Name:</strong> ${order.customer_name}</p>
                            <p><strong>Email:</strong> ${order.customer_email}</p>
                            <p><strong>Phone:</strong> ${order.customer_phone || 'Not provided'}</p>
                            <p><strong>Address:</strong> ${order.customer_address || 'Not provided'}</p>
                            
                            <h4 style="margin-top: 20px;">Order Summary</h4>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                <tr>
                                    <td><strong>Subtotal:</strong></td>
                                    <td style="text-align: right;">$${order.subtotal || 0}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tax:</strong></td>
                                    <td style="text-align: right;">$${order.tax || 0}</td>
                                </tr>
                                <tr>
                                    <td><strong>Total:</strong></td>
                                    <td style="text-align: right; font-weight: bold;">$${order.total || 0}</td>
                                </tr>
                            </table>
                            
                            <h4 style="margin-top: 20px;">Order Items</h4>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Product</th>
                                        <th style="text-align: center;">Qty</th>
                                        <th style="text-align: right;">Price</th>
                                        <th style="text-align: right;">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${itemsHtml || '<tr><td colspan="4" style="text-align: center;">No items found</td></tr>'}
                                </tbody>
                            </table>
                            
                            <h4 style="margin-top: 20px;">Status Information</h4>
                            <p><strong>Status:</strong> <span class="badge badge-${order.status}">${order.status}</span></p>
                            <p><strong>Payment Method:</strong> ${order.payment_method || 'Not specified'}</p>
                            <p><strong>Payment Status:</strong> <span class="badge ${order.payment_status ? 'badge-completed' : 'badge-pending'}">
                                ${order.payment_status ? 'Paid' : 'Pending'}
                            </span></p>
                            <p><strong>Order Date:</strong> ${order.created_at}</p>
                        </div>
                    `;
                    document.getElementById('orderDetailsContent').innerHTML = content;
                    openModal('orderDetailsModal');
                }
            } catch (error) {
                console.error('Error loading order details:', error);
                showToast('Error loading order details', 'error');
            }
        }

        // Messages Management
        async function loadMessages() {
            try {
                const tbody = document.getElementById('messagesTableBody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;"><div class="spinner"></div></td></tr>';
                
                const response = await fetch('/dravtech/admin/api/messages/');
                const data = await response.json();
                
                if (data.success) {
                    tbody.innerHTML = '';
                    
                    if (data.messages.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No messages found.</td></tr>';
                        return;
                    }
                    
                    data.messages.forEach(msg => {
                        const row = document.createElement('tr');
                        row.id = `message-${msg.type}-${msg.id}`;
                        row.className = msg.is_read ? '' : 'unread';
                        row.innerHTML = `
                            <td>
                                <span class="badge ${msg.type === 'contact' ? 'badge-primary' : 'badge-success'}">
                                    ${msg.type === 'contact' ? 'Contact' : 'Portfolio'}
                                </span>
                            </td>
                            <td>${msg.name}</td>
                            <td>${msg.email}</td>
                            <td>${msg.message_preview || msg.message?.substring(0, 50) + '...'}</td>
                            <td>${msg.created_at}</td>
                            <td>
                                <span class="badge ${msg.is_read ? 'badge-completed' : 'badge-pending'}">
                                    ${msg.is_read ? 'Read' : 'Unread'}
                                </span>
                            </td>
                            <td>
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-sm btn-outline" onclick="viewMessageDetails('${msg.type}', ${msg.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteMessage('${msg.type}', ${msg.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Error loading messages</td></tr>';
                }
            } catch (error) {
                console.error('Error loading messages:', error);
                showToast('Error loading messages', 'error');
                const tbody = document.getElementById('messagesTableBody');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Error loading messages</td></tr>';
            }
        }

        async function viewMessageDetails(messageType, messageId) {
            try {
                const response = await fetch(`/dravtech/admin/api/messages/${messageType}/${messageId}/`);
                const data = await response.json();
                
                if (data.success) {
                    const msg = data.message;
                    const content = `
                        <div style="line-height: 1.6;">
                            <h3 style="margin-bottom: 20px;">${messageType === 'contact' ? 'Contact' : 'Portfolio'} Message</h3>
                            <p><strong>From:</strong> ${msg.name} &lt;${msg.email}&gt;</p>
                            <p><strong>Date:</strong> ${msg.created_at}</p>
                            <p><strong>Status:</strong> <span class="badge ${msg.is_read ? 'badge-completed' : 'badge-pending'}">
                                ${msg.is_read ? 'Read' : 'Unread'}
                            </span></p>
                            <p><strong>Message:</strong></p>
                            <div style="background: var(--light-color); padding: 15px; border-radius: var(--radius); margin-top: 10px; white-space: pre-wrap;">
                                ${msg.message}
                            </div>
                        </div>
                    `;
                    document.getElementById('messageDetailsContent').innerHTML = content;
                    openModal('messageDetailsModal');
                    
                    // Mark row as read
                    const row = document.getElementById(`message-${messageType}-${messageId}`);
                    if (row) {
                        row.classList.remove('unread');
                        row.querySelector('.badge').className = 'badge badge-completed';
                        row.querySelector('.badge').textContent = 'Read';
                    }
                }
            } catch (error) {
                console.error('Error loading message details:', error);
                showToast('Error loading message details', 'error');
            }
        }

        async function deleteMessage(messageType, messageId) {
            if (!confirm('Are you sure you want to delete this message?')) return;
            
            try {
                const response = await fetch(`/dravtech/admin/api/messages/${messageType}/${messageId}/delete/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    document.getElementById(`message-${messageType}-${messageId}`).remove();
                    loadDashboardStats();
                } else {
                    showToast(data.error, 'error');
                }
            } catch (error) {
                console.error('Error deleting message:', error);
                showToast('Error deleting message', 'error');
            }
        }

        async function clearAllMessages() {
            if (!confirm('Are you sure you want to clear ALL messages? This action cannot be undone.')) return;
            
            try {
                const response = await fetch('/dravtech/admin/api/messages/clear/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCsrfToken(),
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(data.message, 'success');
                    document.getElementById('messagesTableBody').innerHTML = 
                        '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No messages found.</td></tr>';
                    loadDashboardStats();
                } else {
                    showToast(data.error, 'error');
                }
            } catch (error) {
                console.error('Error clearing messages:', error);
                showToast('Error clearing messages', 'error');
            }
        }

        // Utility Functions
        async function refreshDashboard() {
            showToast('Refreshing dashboard...', 'info');
            
            try {
                await Promise.all([
                    loadDashboardStats(),
                    loadRecentActivity(),
                    loadProducts(),
                    loadCategories(),
                    loadApps(),
                    loadDemos(),
                    loadOrders(),
                    loadMessages()
                ]);
                
                showToast('Dashboard refreshed successfully!', 'success');
            } catch (error) {
                console.error('Error refreshing dashboard:', error);
                showToast('Error refreshing dashboard', 'error');
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/dravtech/admin/logout/';
            }
        }

        function exportData() {
            showToast('Export feature coming soon!', 'info');
        }

        function exportDemos() {
            showToast('Exporting demo requests...', 'info');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data
            loadDashboardStats();
            loadRecentActivity();
            loadCategoriesForSelect();
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
            
            // Set initial active section
            showSection('dashboard');
        });

        // Event listener for stat cards
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.stat-card').forEach(card => {
                card.addEventListener('click', function() {
                    const targetSection = this.getAttribute('onclick')?.match(/showSection\('([^']+)'\)/)?.[1];
                    if (targetSection) {
                        showSection(targetSection);
                    }
                });
            });
        });
    </script>
</body>
</html>